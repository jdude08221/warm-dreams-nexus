<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Dustkid Leaderboard</title>
</head>
<body>
    <h1>Dustkid Leaderboard</h1>
    <form method="post" style="text-align:center; margin-bottom: 30px;">
        <label for="user_id">Enter User ID:</label>
        <input type="text" id="user_id" name="user_id" value="{{ user_id or '' }}">
        <button type="submit">Search</button>
    </form>
    <div class="nexus">
        {% for area, data in leaderboard_data.items() %}
            <div class="area">
                <div class="subtables-row">
                    <div class="subtable">
                        <div class="area-title">{{ area }}</div>
                        <div class="list-table">
                            {% for score in data.scores %}
                                <div class="list-row">
                                    <a href="{{ score.level_url if score.rank != 'N/A' else 'https://dustkid.com/level/' ~ score.level ~ '/all/0' }}" target="_blank" class="level-link">{{ score.level }}</a>
                                    {% if score.rank == "N/A" %}
                                        <span class="level-na"> - N/A</span>
                                    {% else %}
                                        <span class="rank" data-rank="{{ score.rank }}">#{{ score.rank }}</span>
                                        {% if score.character_img %}
                                            <img src="{{ url_for('static', filename=score.character_img) }}" alt="char" class="char-img">
                                        {% endif %}
                                        <span class="score-letters">
                                            {% if score.score_completion != "N/A" and score.score_finesse != "N/A" %}
                                                <span class="score-letter score-{{ score.score_completion|lower }}">{{ score.score_completion }}</span>
                                                <span class="score-letter score-{{ score.score_finesse|lower }}">{{ score.score_finesse }}</span>
                                            {% endif %}
                                        </span>
                                        {% if score.replay_id and score.time != "N/A" %}
                                            <a href="https://dustkid.com/replay/{{ score.replay_id }}" target="_blank" class="time-link">{{ score.time }}</a>
                                        {% else %}
                                            <span class="time-na">{{ score.time }}</span>
                                        {% endif %}
                                        <span class="time-off-wr">{{ score.time_off_world_record }}</span>
                                        <span class="pb-time">{{ score.time_of_pb }}</span>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="subtable">
                        <div class="area-title">{{ area }}</div>
                        <div class="list-table">
                            {% for time in data.times %}
                                <div class="list-row">
                                    <a href="{{ time.level_url if time.rank != 'N/A' else 'https://dustkid.com/level/' ~ time.level ~ '/all/0' }}" target="_blank" class="level-link">{{ time.level }}</a>
                                    {% if time.rank == "N/A" %}
                                        <span class="level-na"> - N/A</span>
                                    {% else %}
                                        <span class="rank" data-rank="{{ time.rank }}">#{{ time.rank }}</span>
                                        {% if time.character_img %}
                                            <img src="{{ url_for('static', filename=time.character_img) }}" alt="char" class="char-img">
                                        {% endif %}
                                        <span class="score-letters">
                                            {% if time.score_completion != "N/A" and time.score_finesse != "N/A" %}
                                                <span class="score-letter score-{{ time.score_completion|lower }}">{{ time.score_completion }}</span>
                                                <span class="score-letter score-{{ time.score_finesse|lower }}">{{ time.score_finesse }}</span>
                                            {% endif %}
                                        </span>
                                        {% if time.replay_id and time.time != "N/A" %}
                                            <a href="https://dustkid.com/replay/{{ time.replay_id }}" target="_blank" class="time-link">{{ time.time }}</a>
                                        {% else %}
                                            <span class="time-na">{{ time.time }}</span>
                                        {% endif %}
                                        <span class="time-off-wr">{{ time.time_off_world_record }}</span>
                                        <span class="pb-time">{{ time.time_of_pb }}</span>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
<script>
document.addEventListener("DOMContentLoaded", function() {
    function hsl_to_rgb(h, s, l) {
        let c = (1 - Math.abs(2 * l - 1)) * s;
        let x = c * (1 - Math.abs((h / 60) % 2 - 1));
        let m = l - c / 2;
        let r1, g1, b1;
        if (h < 60)      { r1 = c; g1 = x; b1 = 0; }
        else if (h < 120){ r1 = x; g1 = c; b1 = 0; }
        else if (h < 180){ r1 = 0; g1 = c; b1 = x; }
        else if (h < 240){ r1 = 0; g1 = x; b1 = c; }
        else if (h < 300){ r1 = x; g1 = 0; b1 = c; }
        else             { r1 = c; g1 = 0; b1 = x; }
        let r = Math.round((r1 + m) * 255);
        let g = Math.round((g1 + m) * 255);
        let b = Math.round((b1 + m) * 255);
        return [r, g, b];
    }
    function pad_num(num, length, base) {
        let s = num.toString(base);
        return s.padStart(length, '0');
    }
    function format_rank_color(rank) {
        if (!Number.isInteger(rank)) return "#cccccc";
        let hue = 60 + 180 * (1 - Math.min(1, Math.log(rank + 1) / Math.log(1000)));
        hue -= 30 * Math.max(0, Math.min(2, Math.floor(
            Math.log(rank + 1) / Math.log(10) - 1e-9)));
        let color = hsl_to_rgb(hue, 0.7, 0.6);
        return "#" + pad_num(color[0], 2, 16) + pad_num(color[1], 2, 16) + pad_num(color[2], 2, 16);
    }
    document.querySelectorAll('.rank').forEach(function(el) {
        let rank = parseInt(el.getAttribute('data-rank'));
        if (!isNaN(rank)) {
            el.style.color = format_rank_color(rank);
        }
    });
});
</script>
</body>
</html>